# Inventory Events and Checks

## Inventory Events {#inventory-events}

`InventoryEvents` class is used to raise and subscribe to inventory events, such as using an item, combining items, targeting an item and etc. You can get the `InventoryEvents` instance associated with an inventory with `GetEvents()` extension method:

```csharp
InventoryEvents events = Inventory.GetEvents();
```

You can subscribe to these events:

```csharp
events.OnItemUsed += Events_OnItemUsed;
...
public void Events_OnItemUsed(OnItemUsedArgs e)
{
    ...
}
```

There's also a global instance of `InventoryEvents` that handles **all** events:

```csharp
InventoryEvents.Global.OnItemsCombined += Global_OnItemsCombined;
...
public void Global_OnItemsCombined(OnItemsCombinedArgs e)
{
    ...
}
```

## Inventory Checks {#inventory-checks}

So, instead of adding your own checks like this:

```csharp
if (Owner.statusEffects.hasTrait("BloodRestoresHealth"))
{
    Owner.SayDialogue("WontEatThis");
    return;
}
if (Owner.statusEffects.hasTrait("OilRestoresHealth"))
{
    Owner.SayDialogue("WontEatThat");
    return;
}
if (Owner.health == Owner.maxHealth)
{
    Owner.SayDialogue("NoImFull");
    return;
}
...
```

RogueLibs allows you to make universal checks, called **inventory checks**, that will work on all items in the game that meet a certain criteria (for example, have "Food" type and an "Alcohol" category). These inventory checks also implement some usual stuff, that modders sometimes forget to implement. For example, removing an item from the inventory or stopping the interaction, when the item's count reaches 0.

### Adding your inventory checks {#adding-checks}

:::danger
<span style={{filter:'invert(100%)'}}><b>The Inventory Checks' public API is subject to change.</b></span>
:::

For example, there's a trait called `"Vegetarian"` that should prohibit the player from consuming food with `"Meat"` category:

```csharp
InventoryEvents.OnItemUseCheck += e =>
{
    if (!e.Item.IgnoresUseItemCheck("Vegetarian") && e.User.HasTrait("Vegetarian")
        && e.Item.itemType == ItemTypes.Food && e.Item.Categories.Contains("Meat"))
    {
        // do something to indicate why the item cannot be used
        e.User.gc.audioHandler.Play(e.User, "CantDo");
        // set Cancel and Handled to true
        e.Cancel = e.Handled = true;
    }
};
```

`RogueEventArgs` class has two properties: `Cancel` and `Handled`. If you set `Handled` to `true`, then all other checks will be ignored. If you set `Cancel` to `true`, then the action that was going to happen will not happen. Usually, they are set to `true` at the same time.

The inventory checks can be ignored with an `IgnoreChecks` attribute:

```csharp
[ItemCategories(RogueCategories.Food, RogueCategories.Weird, "Meat")]
public class MysteryFood : CustomItem, IItemUsable
{
    // highlight-next-line
    [IgnoreChecks("Vegetarian")]
    public void UseItem()
    {
        e.User.ChangeHealth(Item.healthChange);
        Count--;
        e.User.SayDialogue("Huh, tasty. I wonder what that was...");
        UseItemAnim();
    }
}
```

### Default Inventory Checks {#default-checks}

#### `UseItem` {#useitem-checks}

Name | Criteria | Dialogue
:--- |:-------- |:--------
`Ghost` | Player is a ghost. | -
`CantInteract` | "Pea-Brained" trait, **NOT** Food type. | "???" or "GRRRRRRRR!!!!!"
`OnlyOil` | "Oil Reliant" trait, Food type and (Food or Alcohol category). | "I'm gonna need some oil..."
`OnlyOilMedicine` | "Oil Reliant" trait, Consumable type and Health category. | "I'm gonna need some oil..."
`OnlyBlood` | "Jugularious" trait, Food type and (Food or Alcohol category). | "Ew gross, I'm not putting that in my mouth!"
`OnlyBloodMedicine` | "Jugularious" trait, Consumable type and Health category. | "Modern medicine is for humans, I want BLOOD!"
`OnlyCharge` | "Electronic" trait, Food type and Food category. | "I don't exactly have a stomach."
`OnlyHumanFlesh` | "Strict Cannibal" trait, Food type and Food category. | "Ew gross, I'm not putting that in my mouth!"
`HealthFull` | Player's health is at full and the item's `healthChange` is greater than 0. | "No need, I'm feelin' good!"

#### `CombineFilter` {#combinefilter-checks}

Name | Criteria | What will happen
:--- |:-------- |:----------------
`StackItems` | Items have the same name | They will be stacked together

#### `CombineItems` {#combineitems-checks}

Name | Criteria | What will happen
:--- |:-------- |:----------------
`StopOnZero` | The current item's count is 0, or is no longer in the inventory | Interaction/combining will be stopped

#### `CombineTooltip` {#combinetooltip-checks}

Name | Criteria | What will happen
:--- |:-------- |:----------------
`CombineFilter` | `CombineFilter` method returned `false` for the item | The tooltip will be empty

#### `TargetFilter` {#targetfilter-checks}

Name | Criteria | What will happen
:--- |:-------- |:----------------
`Distance` | The target object is over 15 units away | `false`
`ButlerBot` | The target is a Butler Bot | `false`
`EmptyMech` | The target is an Empty Mech | `false`

#### `TargetObject` {#targetobject-checks}

Name | Criteria | What will happen
:--- |:-------- |:----------------
`StopOnZero` | The current item's count is 0, or is no longer in the inventory | Interaction/targeting will be stopped

#### `TargetTooltip` {#targettooltip-checks}

None.