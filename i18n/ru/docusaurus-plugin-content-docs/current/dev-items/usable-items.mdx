# Используемые предметы

import Tabs from '@site/src/components/Tabs';
import TabItem from '@site/src/components/TabItem';
import useBaseUrl from '@docusaurus/useBaseUrl';

## Делаем предметы используемыми {#making-usable}

Просто реализуйте интерфейс `IItemUsable` В классе вашего предмета:

```csharp
// highlight-next-line
public class MyCustomItem : CustomItem, IItemUsable
{
    // highlight-start
    public void UseItem()
    {
        ...
    }
    // highlight-end
}
```

:::note
При использовании, большинство предметов проигрывают анимацию с помощью `UseItemAnim`:
:::
:::note
Нужна GIF
:::

## Примеры

<Tabs
    defaultValue="jokebook"
    values={[
        {label:'Сборник шуток', value:'jokebook'},
        {label:'Квантовый хафчик', value:'quantumfud'},
        {label:'Универсальный проход сквозь стены', value:'wildbypasser'},
    ]}>
<TabItem value="jokebook">

Простой используемый предмет, который просто временно изменяет способность персонажа.

```csharp title="JokeBook.cs"
[ItemCategories(RogueCategories.Usable, RogueCategories.Social)]
public class JokeBook : CustomItem, IItemUsable
{
    public override void SetupDetails()
    {
        Item.itemType = ItemTypes.Tool;
        Item.itemValue = 40;
        Item.initCount = 10;
        Item.rewardCount = 10;
        Item.stackable = true;
        Item.hasCharges = true;
        Item.goesInToolbar = true;
    }
    public void UseItem()
    {
        // Просто временно изменяем способность персонажа
        string prev = Owner.specialAbility;
        Owner.specialAbility = "Joke";
        Owner.statusEffects.PressedSpecialAbility();
        Owner.specialAbility = prev;

        // отнимаем 1 от количества предмета и проигрываем анимацию
        Count--;
        UseItemAnim();
    }
}
```

```csharp
RogueLibs.CreateCustomItem<JokeBook>()
    .WithName(new CustomNameInfo("Joke Book")
    { Russian = "Сборник шуток" });)
    .WithDescription(new CustomNameInfo("Always wanted to be a Comedian? Now you can! (kind of)")
    { Russian = "Всегда хотели быть Комиком? Теперь вы можете! (типа)" });)
    .WithSprite(Properties.Resources.JokeBook)
    .WithUnlock(new ItemUnlock
    {
        UnlockCost = 10,
        CharacterCreationCost = 3,
        LoadoutCost = 3,
        // БК Комика должен быть пройден, чтобы разблокировать Сборник шуток
        Prerequisites = { "Comedian_BQ" },
    });
```

</TabItem>
<TabItem value="quantumfud">

Более сложный предмет еды. Использует [интерфейс `IDoUpdate`](../dev-extra/other#update-interfaces) для кулдауна.

```csharp title="QuantumFud.cs"
[ItemCategories(RogueCategories.Food, RogueCategories.Technology)]
public class QuantumFud : CustomItem, IItemUsable, IDoUpdate
{
    public override void SetupDetails()
    {
        Item.itemType = ItemTypes.Food;
        Item.itemValue = 180;
        Item.healthChange = 1;
        Item.cantBeCloned = true;
        Item.goesInToolbar = true;
    }
    public void UseItem()
    {
        if (Cooldown != 0f) return;
        
        // определяем насколько изменится здоровье
        int heal = new ItemFunctions().DetermineHealthChange(Item, Owner);
        Owner.statusEffects.ChangeHealth(heal);

        // Если у игрока есть особенность "Делись здоровьем", поделимся им
        if (Owner.HasTrait("HealthItemsGiveFollowersExtraHealth")
            || Owner.HasTrait("HealthItemsGiveFollowersExtraHealth2"))
            new ItemFunctions().GiveFollowersHealth(Owner, heal);

        // проигрываем звук и анимацию
        gc.audioHandler.Play(Owner, "UseFood");
        UseItemAnim();
        // выставляем кулдаун, чтобы игроки не могли просто кликать 20-30 раз в секунду и быть практически неуязвимыми
        Cooldown = 0.5f;
    }
    public float Cooldown { get; set; }
    // отнимаем Time.deltaTime от Cooldown, но при этом Cooldown не будет меньше 0.
    public void Update() => Cooldown = Math.Max(Cooldown - Time.deltaTime, 0f);
}
```

```csharp
RogueLibs.CreateCustomItem<QuantumFud>()
    .WithName(new CustomNameInfo("Quantum Fud")
    { Russian = "Квантовый хафчик" })
    .WithDescription(new CustomNameInfo("A very complicated piece of quantum technology. When you eat it, its quantum equivalent clone is consumed, while the original thing remains intact.")
    { Russian = "Очень сложное квантовое устройство. Когда его ешь, употребляется его квантово эквивалентный клон, а сам оригинал остаётся нетронутым." })
    .WithSprite(Properties.Resources.QuantumFud)
    .WithUnlock(new ItemUnlock
    {
        UnlockCost = 10,
        CharacterCreationCost = 10,
        LoadoutCost = 10,
        // Кухонный комбайн должен быть разблокирован, чтобы разблокировать Квантовый хафчик
        Prerequisites = { "FoodProcessor" },
    });
```

</TabItem>
<TabItem value="wildbypasser">

Сложный предмет-инструмент, основанный на коде Прохода сквозь стены (см. `ItemFunctions.UseItem`).

```csharp title="WildBypasser.cs"
[ItemCategories(RogueCategories.Technology, RogueCategories.Usable, RogueCategories.Stealth)]
public class WildBypasser : CustomItem, IItemUsable
{
    public override void SetupDetails()
    {
        Item.itemType = ItemTypes.Tool;
		Item.itemValue = 60;
		Item.initCount = 1;
		Item.rewardCount = 1;
		Item.stackable = true;
		Item.goesInToolbar = true;
    }
    public void UseItem()
    {
        Vector3 position = Owner.agentHelperTr.localPosition = Vector3.zero;
		TileData tileData;
		int limit = 0;
		do
		{
			position.x += 0.64f;
			Owner.agentHelperTr.localPosition = position;
			tileData = gc.tileInfo.GetTileData(Owner.agentHelperTr.position);

		} while ((gc.tileInfo.IsOverlapping(Owner.agentHelperTr.position, "Anything")
            || tileData.wallMaterial != wallMaterialType.None) && limit++ < 250);

		if (limit > 250) return;

		Owner.SpawnParticleEffect("Spawn", Owner.tr.position);
		Owner.Teleport(Owner.agentHelperTr.position, false, true);
		Owner.rb.velocity = Vector2.zero;

		if (!(Owner.HasTrait("ThiefToolsMayNotSubtract2")
                && gc.percentChance(Owner.DetermineLuck(80, "ThiefToolsMayNotSubtract", true)))
            && !(Owner.HasTrait("ThiefToolsMayNotSubtract")
                && gc.percentChance(Owner.DetermineLuck(40, "ThiefToolsMayNotSubtract", true))))
			Count--;

        // спавним частицы, проигрываем звук и анимацию
		Owner.SpawnParticleEffect("Spawn", Owner.tr.position, false);
		gc.audioHandler.Play(Owner, "Spawn");
		UseItemAnim();
    }
}
```

```csharp
RogueLibs.CreateCustomItem<WildBypasser>()
    .WithName(new CustomNameInfo("Wild Bypasser")
    { Russian = "Универсальный проход сквозь стены" })
    .WithDescription(new CustomNameInfo("Warps you in the direction you're facing. Teleports through any amount of walls.")
    { Russian = "Телепортирует вас вперёд сквозь любое количество стен." })
    .WithSprite(Properties.Resources.WildBypasser)
    .WithUnlock(new ItemUnlock
    {
        UnlockCost = 10,
        CharacterCreationCost = 2,
        LoadoutCost = 2,
        // Проход сквозь стены должен быть разблокирован, чтобы разблокировать Универсальный проход сквозь стены
        Prerequisites = { "WallBypasser" }
    });
```

</TabItem>
</Tabs>